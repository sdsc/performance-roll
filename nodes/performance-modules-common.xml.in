<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
Performance tools
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

# Remove /etc/profile.d files in favor of loadable modules when available

if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.csh` = 0; then
  echo 'setenv MODULEPATH /opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.csh
  echo 'if ( -s ${HOME}/.modules ) then' >> /etc/profile.d/modules.csh
  echo 'source ${HOME}/.modules' >> /etc/profile.d/modules.csh
  echo 'endif' >> /etc/profile.d/modules.csh

fi
if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.sh` = 0; then
  echo 'export MODULEPATH=/opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.sh
  echo 'if test -f ${HOME}/.modules; then' >> /etc/profile.d/modules.sh
  echo '. ${HOME}/.modules' >> /etc/profile.d/modules.sh
  echo 'fi' >> /etc/profile.d/modules.sh
fi


<!-- PDT  -->


<file name="/opt/modulefiles/applications/.ROLLCOMPILER/pdt/3.15" perms="0644">
#%Module1.0
prepend-path PATH /opt/pdt/ROLLCOMPILER/x86_64/bin
prepend-path LD_LIBRARY_PATH /opt/pdt/ROLLCOMPILER/x86_64/lib
</file>

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/pdt/.version.3.15" perms="0644">
#%Module1.0
set ModulesVersion "3.15"
</file>

/bin/ln -s /opt/modulefiles/applications/.ROLLCOMPILER/pdt/.version.3.15 \
      /opt/modulefiles/applications/.ROLLCOMPILER/pdt/.version



<!-- MXML -->

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/mxml/2.7" perms="0644">
#%Module1.0
prepend-path PATH /opt/mxml/ROLLCOMPILER/bin
prepend-path LD_LIBRARY_PATH /opt/mxml/.ROLLCOMPILER/lib
</file>

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/mxml/.version.2.7" perms="0644">
#%Module1.0
set ModulesVersion "2.7"
</file>

/bin/ln -s /opt/modulefiles/applications/.ROLLCOMPILER/mxml/.version.2.7 \
               /opt/modulefiles/applications/.ROLLCOMPILER/mxml/.version

<!-- PAPI -->

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/papi/4.2.1" perms="0644">
#%Module1.0
prepend-path PATH /opt/papi/ROLLCOMPILER/bin
prepend-path LD_LIBRARY_PATH /opt/papi/ROLLCOMPILER/lib
</file>

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/papi/.version.4.2.1" perms="0644"> 
#%Module1.0
set ModulesVersion "4.2.1"
</file>

/bin/ln -s /opt/modulefiles/applications/.ROLLCOMPILER/papi/.version.4.2.1\
               /opt/modulefiles/applications/.ROLLCOMPILER/papi/.version


<!-- TAU -->

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/tau/2.19" perms="0644">
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiType mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiType mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiType mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiType openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path PATH /opt/tau/ROLLCOMPILER/$mpiType/x86_64bin
prepend-path LD_LIBRARY_PATH /opt/tau/ROLLCOMPILER/$mpiType/x86_64/lib
</file>

<file name="/opt/modulefiles/applications/.ROLLCOMPILER/tau/.version.2.19">
#%Module1.0
set ModulesVersion "2.19"
</file>

  /bin/ln -s /opt/modulefiles/applications/.ROLLCOMPILER/tau/.version.2.19 \
             /opt/modulefiles/applications/.ROLLCOMPILER/tau/.version


<!-- IPM -->


<file name="/opt/modulefiles/applications/.ROLLCOMPILER/ipm/2.0.0" perms="0644" >
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiType mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiType mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiType mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiType openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path PATH /opt/ipm/ROLLCOMPILER/$mpiType/bin
prepend-path LD_LIBRARY_PATH /opt/ipm/ROLLCOMPILER/$mpiType/lib
#%Module1.0
</file>
<file name="/opt/modulefiles/applications/.ROLLCOMPILER/ipm/.version.2.0.0" perms="0644">
#%Module1.0
set ModulesVersion "2.0.0"
</file>
/bin/ln -s /opt/modulefiles/applications/.ROLLCOMPILER/ipm/.version.2.0.0 \
               /opt/modulefiles/applications/.ROLLCOMPILER/ipm/.version


</post>

</kickstart>
